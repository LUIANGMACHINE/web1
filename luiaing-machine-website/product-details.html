<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>产品详情 - LUIANG MACHINE</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/responsive.css">
</head>
<body>
    <!-- 社交链接侧边栏 -->
    <div class="social-sidebar">
        <a href="https://facebook.com" target="_blank" class="social-link">
            <i class="fab fa-facebook-f"></i>
        </a>
        <a href="https://instagram.com" target="_blank" class="social-link">
            <i class="fab fa-instagram"></i>
        </a>
        <a href="https://twitter.com" target="_blank" class="social-link">
            <i class="fab fa-twitter"></i>
        </a>
        <a href="https://linkedin.com" target="_blank" class="social-link">
            <i class="fab fa-linkedin-in"></i>
        </a>
        <a href="https://wa.me/8617712875791" target="_blank" class="social-link">
            <i class="fab fa-whatsapp"></i>
        </a>
    </div>

    <!-- Header将通过JS动态加载 -->
    
    <main>
        <section class="product-details-page">
            <div class="container">
                <div class="breadcrumb">
                    <a href="index.html" data-lang="home">首页</a> &gt;
                    <a href="products.html" data-lang="products">产品中心</a> &gt;
                    <span id="product-category-breadcrumb"></span> &gt;
                    <span id="product-name-breadcrumb"></span>
                </div>

                <div class="product-details-content">
                    <div class="product-gallery">
                        <div class="main-image">
                            <img id="main-product-image" src="" alt="">
                        </div>
                    </div>

                    <div class="product-info">
                        <h1 id="product-name"></h1>
                        <div class="product-meta">
                            <span class="product-category" id="product-category"></span>
                            <span class="product-sku" data-lang="sku">产品编号: <span id="product-id"></span></span>
                        </div>
                        
                        <div class="product-price-section">
                            <span class="price" id="product-price"></span>
                        </div>

                        <div class="product-description">
                            <p id="product-full-description"></p>
                        </div>

                        <div class="product-specifications">
                            <h3 data-lang="specifications">产品规格</h3>
                            <div class="specs-grid" id="product-specs">
                                <!-- 规格将通过JS动态添加 -->
                            </div>
                        </div>

                        <div class="product-actions">
                            <div class="quantity-selector">
                                <label data-lang="quantity">数量:</label>
                                <input type="number" id="product-quantity" value="1" min="1">
                            </div>
                            <button class="btn-primary add-to-cart-large" id="add-to-cart-detail">
                                <span data-lang="add-to-cart">加入购物车</span>
                            </button>
                            <button class="btn-secondary" id="request-quote-detail" data-lang="request-quote">立即询价</button>
                        </div>

                        <div class="product-features">
                            <h3 data-lang="key-features">主要特点</h3>
                            <ul id="product-features-list">
                                <!-- 特点将通过JS动态添加 -->
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- 相关产品 -->
                <div class="related-products">
                    <h2 data-lang="related-products">相关产品</h2>
                    <div class="related-products-grid" id="related-products-grid">
                        <!-- 相关产品将通过JS动态加载 -->
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer将通过JS动态加载 -->

    <script src="js/language-system.js"></script>
    <script src="js/components-loader.js"></script>
    <script src="js/cart.js"></script>
    <script src="js/social-links.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            loadProductDetails();
        });

        function getProductIdFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('id');
        }

        function loadProductDetails() {
            const productId = getProductIdFromURL();
            if (!productId) {
                window.location.href = 'products.html';
                return;
            }

            const savedProducts = JSON.parse(localStorage.getItem('products')) || [];
            const defaultProducts = [
                {
                    id: '1',
                    name: '高端加油机',
                    description: '高性能加油机，适用于各种加油站，精确计量，耐用可靠。采用先进的技术和优质材料制造，确保长期稳定运行。',
                    fullDescription: '这款高端加油机采用最新的计量技术和安全系统，能够精确控制燃油流量，防止溢出和泄漏。适用于加油站、物流中心等各种场景。',
                    price: '询价',
                    category: 'fuel-dispenser',
                    image: 'images/product1.jpg',
                    specifications: {
                        'accuracy': '±0.1%',
                        'flow-rate': '5-50 L/min',
                        'material': '不锈钢',
                        'power': '220V/50Hz',
                        'display': 'LCD触摸屏'
                    },
                    features: [
                        '高精度计量系统',
                        '防爆安全设计',
                        '易于维护',
                        '多种支付方式支持',
                        '远程监控功能'
                    ]
                },
                {
                    id: '2',
                    name: '流量计配件',
                    description: '精密流量计配件，确保准确测量，延长设备寿命',
                    fullDescription: '精密制造的流量计配件，采用优质材料，确保长期稳定运行和精确测量。',
                    price: '询价',
                    category: 'pump-flowmeter',
                    image: 'images/product2.jpg',
                    specifications: {
                        'accuracy': '±0.5%',
                        'material': '不锈钢/铜',
                        'temperature': '-20°C 至 80°C',
                        'pressure': '0-1.6MPa'
                    },
                    features: [
                        '精密加工',
                        '耐腐蚀材料',
                        '安装简便',
                        '长期稳定性好'
                    ]
                }
            ];

            let product;
            if (savedProducts.length > 0) {
                product = savedProducts.find(p => p.id === productId);
            } else {
                product = defaultProducts.find(p => p.id === productId);
            }

            if (!product) {
                window.location.href = 'products.html';
                return;
            }

            displayProductDetails(product);
            loadRelatedProducts(product.category, product.id);
        }

        function displayProductDetails(product) {
            // 更新页面标题
            document.title = `${product.name} - LUIANG MACHINE`;

            // 更新面包屑
            document.getElementById('product-category-breadcrumb').textContent = getTranslation(product.category);
            document.getElementById('product-name-breadcrumb').textContent = product.name;

            // 更新产品信息
            document.getElementById('main-product-image').src = product.image || 'images/default-product.jpg';
            document.getElementById('main-product-image').alt = product.name;
            document.getElementById('product-name').textContent = product.name;
            document.getElementById('product-category').textContent = getTranslation(product.category);
            document.getElementById('product-id').textContent = product.id;
            document.getElementById('product-price').textContent = product.price;
            document.getElementById('product-full-description').textContent = product.fullDescription || product.description;

            // 更新规格
            const specsGrid = document.getElementById('product-specs');
            if (specsGrid && product.specifications) {
                let specsHtml = '';
                for (const [key, value] of Object.entries(product.specifications)) {
                    specsHtml += `
                        <div class="spec-item">
                            <strong data-lang="${key}">${getTranslation(key)}</strong>
                            <span>${value}</span>
                        </div>
                    `;
                }
                specsGrid.innerHTML = specsHtml;
            }

            // 更新特点
            const featuresList = document.getElementById('product-features-list');
            if (featuresList && product.features) {
                let featuresHtml = '';
                product.features.forEach(feature => {
                    featuresHtml += `<li>${feature}</li>`;
                });
                featuresList.innerHTML = featuresHtml;
            }

            // 设置添加到购物车按钮
            const addToCartBtn = document.getElementById('add-to-cart-detail');
            if (addToCartBtn) {
                addToCartBtn.dataset.productId = product.id;
                addToCartBtn.dataset.productName = product.name;
            }

            // 设置询价按钮
            const requestQuoteBtn = document.getElementById('request-quote-detail');
            if (requestQuoteBtn) {
                requestQuoteBtn.addEventListener('click', function() {
                    const quantity = document.getElementById('product-quantity').value;
                    const emailContent = `询价请求 - ${product.name}\n数量: ${quantity}\n\n来自: ${window.location.href}`;
                    sendEmail(emailContent, `产品询价 - ${product.name}`);
                });
            }

            // 重新应用语言
            applyLanguage();
        }

        function loadRelatedProducts(category, currentProductId) {
            const savedProducts = JSON.parse(localStorage.getItem('products')) || [];
            let relatedProducts;

            if (savedProducts.length > 0) {
                relatedProducts = savedProducts
                    .filter(p => p.category === category && p.id !== currentProductId)
                    .slice(0, 4);
            } else {
                // 默认相关产品
                relatedProducts = [
                    {
                        id: '2',
                        name: '流量计配件',
                        description: '精密流量计配件',
                        price: '询价',
                        category: 'pump-flowmeter',
                        image: 'images/product2.jpg'
                    },
                    {
                        id: '3',
                        name: 'LPG设备',
                        description: '安全可靠的LPG设备',
                        price: '询价',
                        category: 'lpg-equipment',
                        image: 'images/product3.jpg'
                    }
                ];
            }

            displayRelatedProducts(relatedProducts);
        }

        function displayRelatedProducts(products) {
            const grid = document.getElementById('related-products-grid');
            if (!grid) return;

            let html = '';
            products.forEach(product => {
                html += `
                    <div class="product-item">
                        <img src="${product.image || 'images/default-product.jpg'}" alt="${product.name}">
                        <div class="product-info">
                            <h3>${product.name}</h3>
                            <p class="product-description">${product.description}</p>
                            <p class="product-price">${product.price}</p>
                            <div class="product-actions">
                                <button class="btn-primary add-to-cart" 
                                        data-product-id="${product.id}" 
                                        data-product-name="${product.name}">
                                    <span data-lang="add-to-cart">加入购物车</span>
                                </button>
                                <a href="product-details.html?id=${product.id}" class="btn-secondary" data-lang="view-details">查看详情</a>
                            </div>
                        </div>
                    </div>
                `;
            });

            grid.innerHTML = html;
            applyLanguage();
        }

        function sendEmail(content, subject) {
            const email = 'luiangparts@luiangparts.com';
            window.location.href = `mailto:${email}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(content)}`;
        }
    </script>
</body>
</html>